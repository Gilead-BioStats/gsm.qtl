---
output:
  html_document:
    mathjax: null
    toc: true
    toc_float:
      collapsed: false
      smooth_scroll: true
    css: styles.css
params:
  dfResultsStudy: NA
  dfResultsSite: NA
  dfListing: NA
  dfGroups: NA
---

```{r setup, include=FALSE} 
knitr::opts_chunk$set(warning = FALSE, message = FALSE) 
```


```{r, results='asis', echo=FALSE, message=FALSE, warning=FALSE}
# library(gsm.kri)
# library(gt)
# setup <- Report_Setup(
#   dfGroups =  params$dfGroups,
#   dfResults = params$dfResults
# )
```


---
title: "QTL Overview"
subtitle: "Study: ABC"
date: "Snapshot Date: last known"
--- 
## Study Overview

## Results
```{r, echo=FALSE, results='asis'}

#establish how many snapshots there were and find latest one for barchart
length_snapshots = params$dfResultsSite$SnapshotDate %>% unique %>% length
latest_snapshot = unique(params$dfResultsSite$SnapshotDate)[length_snapshots]

qtl_timeseries_study <- gsm.qtl::Widget_TimeSeriesQTL(
  dfResults = params$dfResultsStudy,
  dfGroups = params$dfGroups,
  strOutcome = "Metric"
)

qtl_barchart_site <- gsm.qtl::Widget_BarChartQTL(
  dfResults = params$dfResultsSite %>% filter(SnapshotDate == latest_snapshot),
  dfGroups = params$dfGroups,
  strOutcome = "Metric"
)
lCharts <- list(
  timeSeries = qtl_timeseries_study,
  barChart = qtl_barchart_site
)
gsm.kri::Report_MetricCharts(lCharts)
```

## Inclusion/Exclusion Listing
```{r, echo = FALSE, results='asis'}
reactable::reactable(params$dfListing, searchable = TRUE)
```

```{r echo=FALSE}
group_dropdown <- system.file('report', 'lib', 'overallGroupDropdown.js', package = "gsm.kri")
dropdown_drag <- system.file('report', 'lib', 'dragOverallGroupDropdown.js', package = "gsm.kri")
toggle_toc <- system.file('report', 'lib', 'toggleTOC.js', package = "gsm.kri")
```

```{js, file={group_dropdown}, echo=FALSE }
```

```{js, file={dropdown_drag}, echo=FALSE}
```

```{js, file={toggle_toc}, echo=FALSE}
```
